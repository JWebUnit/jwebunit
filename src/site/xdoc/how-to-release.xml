<?xml version="1.0"?>
<!--

    Copyright (c) 2010, JWebUnit team.

    This file is part of JWebUnit.

    JWebUnit is free software: you can redistribute it and/or modify
    it under the terms of the GNU Lesser General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    JWebUnit is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU Lesser General Public License
    along with JWebUnit.  If not, see <http://www.gnu.org/licenses/>.

-->

<document>
    <properties>
        <author>Julien Henry</author>
        <title>How-To Release JWebUnit</title>
    </properties>
    <body class="default">
        <section name="How-To Release JWebUnit with Maven">
            <p>
                This todo list if a reminder for JWebUnit release manager.
            </p>
            <subsection name="Last checks and updates">
                <p>
                	<ul>
                		<li>Ensure your repository is up to date by running: <tt>svn update</tt></li>
                		<li>Edit <tt>src/changes/changes.xml</tt> to set the release date instead of "unknow"</li>
                		<li>Update readme.txt (at least update the version number)</li>
                		<li>Update JWebUnit latest version in src/site/xdoc/index.xml, src/site/xdoc/installation.xml, jwebunit-htmlunit-plugin/src/site/xdoc/index.xml, jwebunit-selenium-plugin/src/site/xdoc/index.xml</li>
                		<li>Commit the changes</li>
                	</ul>
                </p>
                <p>
                    Now check that in your <tt>settings.xml</tt> (usually in <tt>~/.m2</tt>) 
                    the JWebUnit server details are correct:
                    <source><![CDATA[                    
    <server>
      <id>jwebunit-website</id>
      <username>henryju,jwebunit</username>
      <password>XXXXXXXX</password>
    </server>
    
    <server>
      <id>sonatype-nexus</id>
      <username>henryju</username>
      <password>YYYYYYYYYY</password>
    </server>
]]></source>
                    Don't forget to put your own sourceforge account and password for jwebunit-website. Concerning sonatype-nexus you need
                    the username and password from http://oss.sonatype.org/ (see <a href="https://docs.sonatype.org/display/Repository/Sonatype+OSS+Maven+Repository+Usage+Guide">OSS Repository Hosting</a>)
                    for instructions on how to set up your configuration like GPG signature.
                    Reminder: in order to have access granted to a new JWebUnit developper, ask on <a href="https://issues.sonatype.org/browse/OSSRH-384">OSSRH-384</a>.
                </p>
            </subsection>
            <subsection name="Preparing the release (tag and update pom)">
                <p>
                    This process is automatically done by maven-release-plugin.
                    <source>mvn release:prepare -Dusername=henryju -Dpassword=XXXXXX</source>
                    Don't forget to put your own sourceforge account and password.<br/>
                    The plugin will ask for next release version, tag name and next development version. Most of the time defaults are ok.<br/>
                    <em>NB:</em> Sometimes with SVN 1.5 the tag operation fails with a message like <tt>file XXX already exists</tt>. The solution is
                    to run <tt>svn update</tt> then run <tt>mvn release:prepare -Dusername=henryju -Dpassword=XXXXXX</tt> again.
                </p>
                <p>
                    Now the tag is done in SVN and the trunk is ready for next developments. It's time to actually do the release.
                </p>
            </subsection>
            <subsection name="Perform the release (deploy artifacts and site)">
                <p>
                	First you need to activate a time-limited shell in Sourceforge to allow upload by SCP.
                	On Linux you can use:
                	<source>ssh henryju,jwebunit@shell.sourceforge.net create</source>
                	On Windows you can use:
                	<source>plink henryju,jwebunit@shell.sourceforge.net create</source>
                </p>
               	<p>
                    Now the process is done by maven-release-plugin.
                    <source>mvn release:perform -Darguments="-Dgpg.passphrase=XXXXXXXXXX"</source>
                </p>
                <p>
                    This will automatically checkout the tag from SVN in target/checkout folder then run <tt>mvn deploy site-deploy</tt>.
                    Artifacts will be uploaded in http://jwebunit.sourceforge.net/m2-repo (this repository is synchronized to Maven central repo).
                    Site will also be uploaded.
                </p>
                <p>
                	Now close your Sourceforge shell:
                	<source>ssh henryju,jwebunit@shell.sourceforge.net shutdown</source> (Linux)
                	<source>plink henryju,jwebunit@shell.sourceforge.net shutdown</source> (Windows)
                </p>
            </subsection>
            <subsection name="Dealing with non-maven bundle">
                <p>
                	We have to provide a bundle for non Maven users.
                    <source>
cd target
cd checkout
mvn package assembly:assembly
                    </source>
                    This will create a release bundle in target/checkout/target/jwebunit-XX-release.zip. Move this zip to another directory then run:
                    <source>mvn clean</source>
                    Now remove every .svn folders in target/checkout:
                    <tt>find . -name .svn -exec rm -rf '{}' \;</tt> (works for Linux, on Windows I use the graphical search feature)
                    And finally create a zip of the whole target/checkout folder content with name <tt>jwebunit-XX-sources.zip</tt>
                </p>
                <p>
                	Open your browser at <a href="https://sourceforge.net/projects/jwebunit/">JWebUnir admin page</a>.<br/>
                	Use your Sourceforge account to log in.<br/>
                	In the menu select Project Admin -> File Manager (beta).<br/>
                	Click on JWebUnit folder.<br/>
                	Click on the [Add Folder] button.<br/>
                	Type the name of the new release: JWebUnit-XX<br/>
                	Select the folder you just have created<br/>
                	Click on the [Add File] button.<br/>
                	Browse and select for upload:
                	<ul>
                		<li>jwebunit-XX-release.zip</li>
                		<li>jwebunit-XX-sources.zip</li>
                		<li>README.txt</li>
                	</ul>
                	Click on the [Upload] button.<br/>
                </p>
            </subsection>
            <subsection name="Communication">
                <p>
                	Add a news on the website (Develop -> News). You can copy/paste and adapt the previous one.
                </p>
                <p>
                	Post an email on the user mailing list.
                </p>
            </subsection>
            <subsection name="Go to Bed">
                <p>
                    It's getting late! Go to bed!
                </p>
            </subsection>
        </section>
    </body>
</document>
